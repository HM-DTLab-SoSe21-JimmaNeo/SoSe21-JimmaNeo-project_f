@page "/edituser/{UserId:int}"
@inject Services.UserBackendAccessService UserService
@inject HttpClient Http
@using SEIIApp.Shared;

<h3>EditUser</h3>


@if (userDTO != null)
{



    <label>User Name</label>

     
        <table width="80%">
            <thead>
                <tr border="1">
                    <th>Name</th>
                    <th>Firstname</th>
                    <th>Lastname</th>
                    <th>Role</th>

                    <th></th>

                </tr>
            </thead>

            <tbody>
              
               
                    
                    <tr>
                     <td>@userDTO.Name</td>
                     <td>@userDTO.FirstName</td>
                    <td>@userDTO.LastName</td>
                    <td> <select name="role" id="role" @bind-value="bla" @bind-value:event="onchange">
                            <option value=4 selected>@userDTO.Role</option>
                                <option value=0>Undefined</option>
                                <option value=1>Student</option>
                                <option value=2>Teacher</option>
                                <option value=3>Admin</option>
                            </select></td>
                             
                            <td><button class="btn btn-primary" @onclick="() => SaveRoleChangesOnUser(bla)">Save Changes</button></td>  
                             <NavLink class="nav-link" href="manageuser"><button type="button" class="btn btn-outline-primary">Back</button></NavLink>

  
                        <td>  
                            <br> 
                            <p>@msg</p>
                        </td>
                      
                    </tr>
                
               
                
            </tbody>

        </table>


}else {
    <p>@UserID</p>
      <p>Something went wrong ;(</p>
}

@code {
    [Parameter]
    public int UserID { get; set; }

    public int bla {get; set;}
    private string msg{get; set;}


    public UserDTO userDTO { get; set; }



    protected override async Task OnInitializedAsync()
    {
        userDTO = await UserService.GetUserById(UserID);
    }

    private void SaveRoleChangesOnUser(int bla ){


        switch(bla) {

            case 0: 
                    userDTO.Role = Role.None;
                    break;
            case 1: 
                    userDTO.Role = Role.Student;
                    break;
            case 2: 
                    userDTO.Role = Role.Teacher;
                    break;

            case 3: 
                    userDTO.Role = Role.Admin;
                    break;

            default:
                    msg ="No changes!";
                    break;

           
        }
       var response = UserService.ChangeUser(userDTO);

          if (response != null)
        {
            msg = "Change User was successful!";
        }
        else
        {
            msg = "Change User failed";

        }
    }

}
