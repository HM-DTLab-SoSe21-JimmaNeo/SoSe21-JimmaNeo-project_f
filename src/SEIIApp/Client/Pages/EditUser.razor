@page "/edituser/{UserId:int}"
@inject Services.UserBackendAccessService UserService
@inject HttpClient Http
@using SEIIApp.Shared;

<h3>EditUser</h3>


@if (userDTO != null)
{

            <thead>
                <tr border="1">
                    <th>Name</th>
                    <th>Firstname</th>
                    <th>Lastname</th>
                    <th>Role</th>

                    <th></th>

                </tr>
            </thead>

            <tbody>
   
                    <tr>
                    <td>@userDTO.Name</td>
                    <td>@userDTO.FirstName</td>
                    <td>@userDTO.LastName</td>
                    <td> @userDTO.Role</td>                    
                    <td></td>                               
                                            
                    </tr>
              
                    <tr>
                        
                    </tr>

            </tbody>

            <tfoot>

                <td></td>
                <td><input type="text" id="firstName" size="10" maxlength="10" required @bind="inputFirstName"></td>
                <td> <input type="text" id="lastName" size="10" maxlength="10" required @bind="inputLastName"></td>
                    
                    <td> <select name="role" id="role" @bind-value="chosenOption" @bind-value:event="onchange"> 
                                <option value=0 selected>@userDTO.Role</option>
                                <option value=1>Undefined</option>
                                <option value=2>Student</option>
                                <option value=3>Teacher</option>
                                <option value=4>Admin</option>
                            </select></td>
  
  
                        <td>                             
                            <font color="green">@msg</font>
                        </td>                      
                    
                 
                    <tr>
                        <td> <button class="btn btn-primary" @onclick="() => SaveRoleChangesOnUser(chosenOption)">Save Changes</button>  </td>
                        <td><NavLink class="nav-link" href="manageuser"><button type="button" class="btn btn-outline-primary">Back</button></NavLink> </td>
                    </tr>
                
            </tfoot>

}else {
       <p>@userID</p>
      <font color="red">Something went wrong ;(</font>
}

@code {
    [Parameter]
    public int userID { get; set; }
    public string inputFirstName {get; set;}
    public string inputLastName {get; set;}

    public int chosenOption {get; set;}
    private string msg{get; set;}



    public UserDTO userDTO { get; set; }



    protected override async Task OnInitializedAsync()
    {
        userDTO = await UserService.GetUserById(userID);
    }

    private void SaveRoleChangesOnUser(int chosenOption ){

         if(inputFirstName == null || inputLastName == null) {

            inputFirstName = userDTO.FirstName;
            inputLastName = userDTO.LastName;
          }
             userDTO.FirstName = inputFirstName;
             userDTO.LastName = inputLastName;


        switch(chosenOption) {

             case 0: 
                    userDTO.Role = this.userDTO.Role;
                    break;
            case 1: 
                    userDTO.Role = Role.None;
                    break;
            case 2: 
                    userDTO.Role = Role.Student;
                    break;
            case 3: 
                    userDTO.Role = Role.Teacher;
                    break;

            case 4: 
                    userDTO.Role = Role.Admin;
                    break;

           
            default:           
                    msg ="No changes!";
                    break;

           
        }

       var response = UserService.ChangeUser(userDTO);


          if (response != null)
        {
            msg = "Change User was successful!";
        }
        else
        {
            msg = "Change User failed";

        }
    }



    }




